@model IEnumerable<Azure_Search_and_Recommendations_Demo.Models.Car>

@{
    ViewBag.Title = "Index";
}

<h2>Index</h2>

<p>
    @Html.ActionLink("Create New", "Create")
</p>
<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.Make)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Model)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Year)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Rating)
        </th>
        <th></th>
    </tr>

    @foreach (var item in Model)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.Make)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Model)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Year)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Rating)
            </td>
            <td>
                @Html.ActionLink("Edit", "Edit", new { id = item.Id }) |
                @Html.ActionLink("Details", "Details", new { id = item.Id }) |
                @Html.ActionLink("Delete", "Delete", new { id = item.Id })
            </td>
        </tr>
    }

</table>

<input type="search" id="search-input" />
<button type="submit" class="btn btn-default" onclick="searchCars();"><span class="glyphicon glyphicon-search"></span></button>


<a href="#" class="btn-lg" onclick="getCars();">GetCars</a>

<textarea id="results"></textarea>

<script>

    function getCars() {
        event.preventDefault();

        var results = [];
        // Assign handlers immediately after making the request,
        // and remember the jqxhr object for this request
        var jqxhr = $.get(window.location.origin + "/api/Search/GetCars", function () {

        })
            .done(function (data) {
                for (var i = 0; i < data.length; i++) {
                    results.push(data[i].Document.Make + "-" + data[i].Document.Year + "\n");
                }
            })
            .fail(function (error) {

            })
            .always(function () {
                $("#results").html(results);
            });
    }


    function searchCars() {
        event.preventDefault();

        searchTerm = $("#search-input").val();
        
        var results = [];

        $.ajax({
            url: window.location.origin + "/api/Search/CarsSearch",
            type: 'POST',
            data: JSON.stringify(searchTerm),
            dataType: 'json',
            contentType: "application/json; charset=utf-8",
            success: function (results) {
                populateTextBox(results);               
            },
            error: function (res) {
                alert("Bad thing happend! " + res.statusText);
            }
        });
    }

    function populateTextBox(data) {
        var results = [];
        for (var i = 0; i < data.length; i++) {
            results.push(data[i].Document.Model + " - " + data[i].Document.Year + "\n");
        };

        $("#results").html(results);
    }
</script>
